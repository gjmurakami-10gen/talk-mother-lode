<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8">

    <title>Introduction to MongoDB and Ruby</title>

    <meta name="description" content="JSON-like (or BSON-like) initializers in C">
    <meta name="author" content="Gary J. Murakami">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/theme/default.css">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <script>
        // If the query includes 'print-pdf' we'll use the PDF print sheet
        document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

<!-- Used to fade in a background when a specific slide state is reached -->
<div class="state-background"></div>

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">

<section>
  <section>
    <h2>Introduction to MongoDB and Ruby</h2>
    <p>Gary J. Murakami, Ph.D.</p>
    <br/>
    <p>Lead Engineer & Ruby Evangelist</p>
    <p><a href="http://www.10gen.com/">10gen</a>, the <a href="http://www.mongodb.org/">MongoDB</a> company</p>
    <p><a href="mailto:gary.murakami@10gen.com">gary.murakami@10gen.com</a></p>
    <br/>
    <p>Tuesday, September 25, 2012</p>
  </section>
  <section>
    <h2>Introduction to MongoDB and Ruby</h2>
    <p>Gary J. Murakami, Ph.D.</p>
    <p>Lead Engineer & Ruby Evangelist</p>
    <br/>
    <p>Tuesday, September 25, 2012</p>
    <br/>
    EARLY Session<br/>
    Audio should start immediatly when you log into the event via Audio Broadcast.<br/>
    You will need a Voip headset and reliable internet connection for Audio Broadcast.<br/>
    If you are having issues connecting, please dial 1-877-668-4493; Access code: 662 870 989.<br/>
    Global dial-in numbers can be found on the Event Info tab of your WebEx Event Center screen.<br/>
    <br/>
    There is a Q&A following the webinar. You can enter questions in the chat box to the Host.<br/>
    <br/>
    A recording of the webinar will be available 24 hours after the event is complete.<br/>
    <br/>
    For any other issues please email webinars@10gen.com.<br/>
  </section>
  <section>
    <h2>Introduction to MongoDB and Ruby</h2>
    <p>Gary J. Murakami, Ph.D.</p>
    <p>Lead Engineer & Ruby Evangelist</p>
    <br/>
    <p>Tuesday, September 25, 2012</p>
    <br/>
    LATE Session<br/>
    Audio should start immediatly when you log into the event via Audio Broadcast.<br/>
    You will need a Voip headset and reliable internet connection for Audio Broadcast.<br/>
    If you are having issues connecting, please dial 1-877-668-4493; Access code:  662 191 472.<br/>
    Global dial-in numbers can be found on the Event Info tab of your WebEx Event Center screen.<br/>
    <br/>
    There is a Q&A following the webinar. You can enter questions in the chat box to the Host.<br/>
    <br/>
    A recording of the webinar will be available 24 hours after the event is complete.<br/>
    <br/>
    For any other issues please email webinars@10gen.com.<br/>
  </section>
</section>

<section>
    <h2>MongoDB: Ruby's Mother Lode</h2>
    <div style="float:left">
        <img src="images/ruby-logo.gif" style="border-width:0; background-color:white;"/>
    </div>
    Ruby is a gem of a programming <br/>language<br/>
    dynamic, multi-paradigm<br/>
    expressive, powerful, enjoyable<br/>
    <div style="clear:both"></div>
    <br/>
    <div style="float:left">
        <img src="images/logo-mongodb.png" width="331" style="border-width:0; background-color: #402817;"/>
    </div>
    MongoDB is the mother load of DBs<br/>
    BSON documents, high-performance<br/>
    indexing, replication, sharding<br/>
    adaptable, powerful, enjoyable</br>
    <div style="clear:both"></div>
    <br/>
    <p>Ruby and MongoDB are well matched</p>

</section>

<section>
    <h2>Outfitting</h2>
    <h3><a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-os-x/">Mac OS X</a>- <a href="http://www.mongodb.org/display/DOCS/Quickstart">MongoDB Quickstart</a></h3>
    <ul>
        <li>brew update</li>
        <li>brew install mongodb</li>
        <li>mongod</li>
    </ul>
    <br/>
    <h3><a href="http://www.mongodb.org/display/DOCS/Ruby+Language+Center">Ruby driver setup - Ruby Language Center</a></h3>
    <pre>
    $ gem install mongo
    $ gem install bson_ext
    </pre>

    Gemfile
    <pre><code contenteditable>
        gem 'mongo'
        gem 'bson_ext'
    </code></pre>
</section>

<section>
    <h2>Let's Dig In</h2>
    <h3>Twitter friends - load users</h3>
    <pre><code contenteditable>
        require 'mongo'
        require 'httpclient'
        require 'json'

        screen_name = ARGV[0] || 'garymurakami'
        friends_ids_uri = "https://api.twitter.com/1/friends/ids.json?cursor=-1&screen_name=#{screen_name}"
        friend_ids = JSON.parse(HTTPClient.get(friends_ids_uri).body)['ids']
    </code></pre>
    <p>a few lines of Ruby gets and parses JSON data from the web</p>
    <ul>
        <li>libraries/gems</li>
        <ul>
            <li>mongo, bson, bson_ext</li>
            <li>httpclient, json</li>
        </ul>
        <li>language capability</li>
        <ul>
            <li>method call chaining</li>
        </ul>
    </ul>
</section>

<section>
    <h3>Twitter friends - load users (continued)</h3>
    <pre><code contenteditable>
        connection = Mongo::Connection.new
        db = connection['twitter']
        collection = db['users']

        friend_ids.each_slice(100) do |ids|
            users_lookup_uri = "https://api.twitter.com/1/users/lookup.json?user_id=#{ids.join(',')}"
            response = HTTPClient.get(users_lookup_uri)

            docs = JSON.parse(response.body) # high-level objects
            docs.each{|doc| doc['_id'] = doc['id']} # user supplied _id
            collection.insert(docs, :safe => true) # bulk insert
        end
        puts "users:#{collection.count}"
    </code></pre>
    <p>a small number of lines load JSON data from the web into a collection</p>
    <ul>
        <li>DB connection, database, collection</li>
        <li>docs - Ruby Array of Hashes from JSON parsing</li>
        <li>doc primary _id set by user or driver</li>
        <li>collection bulk insert and safe mode</li>
        <li>collection count</li>
    </ul>
</section>

<section>
    <h3>Twitter top 10 users by followers count</h3>
    <pre><code contenteditable>
        users = Mongo::Connection.new['twitter']['users']

        users.find({}, :sort => { followers_count: -1 }, :limit => 10).each do |doc|
            puts doc.values_at('followers_count', 'screen_name').join("\t")
        end
    </code></pre>
    <p>a simple query with sort and limit</p>
    <ul>
        <li>find - cursor enumerable</li>
        <li>expressed in Ruby code</li>
        <li>driver packages into BSON and Mongo wire protocol</li>
        <li>no text language generation or parsing</li>
    </ul>
    <pre>
    1409213	Dropbox
    25092	MongoDB
    9074	oscon
    8148	railsconf
    7302	spf13
    4374	10gen
    2259	kchodorow
    1925	rit
    1295	dmerr
    1148	aaronheckmann
    </pre>
</section>

<section>
    <h2>Digging Deeper</h2>
    <h3>Twitter - load tweets (simplified)</h3>
    <pre><code contenteditable>
        db = Mongo::Connection.new['twitter']
        users = db['users']
        tweets = db['tweets']
        tweets.ensure_index('user.id') # dot notation to specify subfield

        users.find({}, {fields: {id: true, screen_name: true, since_id: true}}).each do |user|
            twitter_user_timeline_uri =  "https://api.twitter.com/1/statuses/user_timeline.json?user_id=#{user['id']}&count=200&include_rts=true&contributor_details=true"
            twitter_user_timeline_uri += "since_id=#{user['since_id']}" if user['since_id']
            response = HTTPClient.get(twitter_user_timeline_uri)

            docs = JSON.parse(response.body) # high-level objects
            docs.each{|doc| doc['_id'] = doc['id']} # user supplied _id
            tweets.insert(docs, :continue_on_error => true) # bulk insert
            users.update({_id: user['_id']}, {'$set' => {'since_id' => docs.last['id']}})
            puts tweets.count(:query => {'user.id' => user['id']})
        end
        puts "tweets:#{tweets.count}"
    </code></pre>
    <p>a small number of lines loads and records tweets</p>
    <ul>
        <li>indexing - secondary indexes</li>
        <li>dot notation for nested sub-document fields</li>
        <li>retrieving a subset of fields</li>
        <li>update - record since_id</li>
        <li>count with query selector</li>
    </ul>
</section>

<section>
    <h3>Twitter top 10 tweets for MongoDB by retweet_count</h3>
    <pre><code contenteditable>
        tweets = Mongo::Connection.new['twitter']['tweets']

        screen_name = 'MongoDB'

        tweets.find({'user.screen_name' => screen_name}, :sort => { retweet_count: -1 }, :limit => 10).each do |doc|
            puts doc.values_at('retweet_count', 'text').join("\t")
        end
    </code></pre>
    <p>a simple query with a query selector, sort and limit</p>
    <ul>
        <li>Mongo query language</li>
        <li>dot notation for nested sub-document fields</li>
    </ul>
    <pre>
    172	#MongoDB v2.2 released http://t.co/sN6Rzc7D
    77	#mongoDB2dot2 officially released, w/ Advanced Aggregation Framework, Multi-Data Center Deployment + 600 new features http://t.co/DMSdWGwN
    59	Announcing free  online MongoDB classes. http://t.co/RIoAb7l7
    30	RT @jmikola: Introducing mongoqp: a frontend for #MongoDB's query profiler https://t.co/ROCSzs6W
    29	Sign up for free online MongoDB courses starting in October http://t.co/Im68Q4NM
    24	1,000+ have signed up for free MongoDB training since the courses were announced today http://t.co/oINxfH1t
    22	How Disney built a big data platform on a startup budget using MongoDB. http://t.co/8qW5yc7T
    21	#mongoDB2dot2, available for download. http://t.co/kcGhUDhI
    19	MongoDB Sharding Visualizer http://t.co/onIG08jv another product of #10genLabs
    16	MongoDB Java Driver 2.9.0 released http://t.co/UDvZoAYV
    </pre>
</section>

<section>
    <h2>Striking Gold</h2>
    <h3>BSON - Binary JSON</h3>
    <p><a href="http://bsonspec.org/">http://bsonspec.org/</a></p>
    <pre><code contenteditable>
        {"BSON": ["awesome", 5.05, 1986]}	→
        "\x31\x00\x00\x00
        \x04BSON\x00
        &\x00\x00\x00
        \x020\x00\x08\x00\x00\x00awesome\x00
        \x011\x00333333\x14@
        \x102\x00\xc2\x07\x00\x00
        \x00
        \x00"
    </code></pre>
    <ol>
        <li>transfer over wire - Mongo Wire Protocol</li>
        <ul>
            <li>request/query and documents to server</li>
            <li>response and documents to client</li>
        </ul>
        <li>store on server disk</li>
        <li>index on server</li>
    </ol>
    <p>fast - no parsing, no server-side data repackaging to disk</p>
</section>

<section>
    <img src="images/replset.png" style="float:right"/>
    <h3><a href="http://www.mongodb.org/display/DOCS/Replica+Sets">Replica Sets</a></h3>
    <p>multiple database server nodes - one primary, many secondary members</p>
    <ul>
        <li>high availability</li>
        <ul>
            <li>auto-failover via election by majority</li>
            <li>write concern</li>
        </ul>
        <li>read scaling - read preferences</li>
        <br/>
        <li>backups</li>
        <li>upgrades</li>
        <li>use (hidden) replica for secondary workload</li>
        <ul>
            <li>analytics</li>
            <li>data-processing</li>
            <li>integration with external systems</li>
        </ul>
    </ul>
</section>

<section>
    <h3>Sharding</h3>

</section>

<section>
    <h3>Full Featured</h3>
    <p>mongo shell</p>
    <p>map/reduce</p>
    <p>aggregation framework</p>
    <p>GridFS</p>
    <p>Capped collections</p>
    <p>Hadoop connector</p>
</section>

<section>
    <h2>Full-Bore Mining with Web Frameworks</h2>
    <h3><a href="http://mongomapper.com/">MongoMapper ODM - John Nunemaker</a></h3>

    <pre><code contenteditable>
        class User
        include MongoMapper::Document
        key :name, String
        key :age,  Integer
        many :hobbies
        end

        class Hobby
        include MongoMapper::EmbeddedDocument
        key :name,    String
        key :started, Time
        end

        user = User.new(:name => 'Brandon')
        user.hobbies.build(:name => 'Programming', :started => 10.years.ago)
        user.save!

        User.where(:name => 'Brandon').first
    </code></pre>
    <ul>
        <li>simplified model different from ActiveRecord</li>
        <li>good example for Ruby metaprogramming</li>
        <li>small is beautiful</li>
    </ul>
</section>

<section>
    <h3><a href="http://mongoid.org/en/mongoid/index.html">Mongoid ODM - Durran Jordan</a></h3>
    <pre><code contenteditable>
        class Artist
        include Mongoid::Document
        field :name, type: String
        embeds_many :instruments
        end

        class Instrument
        include Mongoid::Document
        field :name, type: String
        embedded_in :artist
        end

        syd = Artist.where(name: "Syd Vicious").between(age: 18..25).first
        syd.instruments.create(name: "Bass")
        syd.with(database: "bands", session: "backup").save!
    </code></pre>
    <ul>
        <li>documents</li>
        <li>persistence</li>
        <li>querying</li>
        <li>ActiveModel relations (belongs_to, has_one, has_many, habtm)</li>
        <li>nested attributes</li>
        <li>validation</li>
        <li>indexing</li>
        <li>extras</li>
    </ul>
</section>

<section>
    <h3><a href="http://mongoid.org/en/moped/">Moped driver - Bernerd Schaefer</a></h3>
    <pre><code contenteditable>
        session = Moped::Session.new([ "127.0.0.1:27017" ])
        session.use "echo_test"

        session.with(safe: true) do |safe|
        safe[:artists].insert(name: "Syd Vicious")
        end

        session[:artists].find(name: "Syd Vicious").update(:$push => { instruments: { name: "Bass" }})
    </code></pre>
    <p>Moped is a MongoDB driver for Ruby,<br/>
       which exposes a simple, elegant, and fast API.<br/>
       Moped is the supported driver for Mongoid<br/>
       from version 3 and higher.</p>
    <ul>
        <li>fast, thread-safe, uses <a href="https://github.com/mperham/sidekiq">sidekiq</a></li>
        <li>pure Ruby - no C extensions</li>
        <li>metaprogramming - extends standard classes</li>
        <li>Ruby > 1.9</li>
    </ul>
</section>

<section>
    <h3>JRuby</h3>
    <ul>
        <li>Java libraries</li>
        <li>bson_java</li>
        <li>Mongo Hadoop connector(?)</li>
        <li>multi-core parallelism</li>
    </ul>
</section>

<section>
    <h2>Refining Ore</h2>
    <h3>Case study - Adobe Photoshop Lightroom</h3>
    <ul>
        <li>"Lightroom 3 Catalog.lrcat"</li>
        <li>0.5 GB</li>
        <li>66 Sqlite3 tables</li>
        <li>20 tables with column image INTEGER</li>
        <li>can be loaded into 40 lines of Ruby</li>
        <li>can be reduced to 1 image collection</li>
    </ul>
    <br/>
    <ul>

    </ul>
</section>

<section>
    <h2>Crafting with Gold</h2>
    <h3>MongoDB Summary</h3>
    <ul>
        <li>replica sets for high availability</li>
        <li>sharded clusters for scaling</li>
        <br/>
        <li>very high performance</li>
        <ul>
            <li>secondary indices</li>
            <li>BSON is fast for transfer, storage, queries</li>
            <li>server-side processing</li>
            <ul>
                <li>map-reduce, aggregation</li>
                <li>Hadoop connector</li>
            </ul>
        </ul>
        <br/>
        <li>very low cost - open source - community</li>
    </ul>
</section>

<section>
    <h2>The Mother Lode</h2>
    <h3>MongoDB Conclusion</h3>
    <ul>
        <li>easy application development</li>
        <ul>
            <li>10gen and Moped Ruby drivers</li>
            <li>MongoMapper and Mongoid ODMs</li>
            <li>no schema migrations</li>
        </ul>
        <br/>
        <li>well-matched to programming languages</li>
        <ul>
            <li>bigger data</li>
            <li>Ruby</li>
        </ul>
    </ul>
</section>

<section>
    <h2>Announcement and Questions</h2>
    <h3><a href="http://blog.10gen.com/post/32158163299/mongodb-and-ruby-blogging-contest">MongoDB and Ruby Blogging Contest</a></h3>
    <p>
        Objective<br/>
        <br/>
        Write about best practices for using MongoDB with Ruby.<br/>
        <br/>
        Post your blog posts in the comments section of<br/>
        this blog post by October 10 to be entered to win.
    </p>
    <br/>
    <a href="http://blog.10gen.com/post/32158163299/mongodb-and-ruby-blogging-contest">http://blog.10gen.com/post/32158163299/mongodb-and-ruby-blogging-contest</a>
</section>

<section>
    <h2>Thank you</h2>
    <h3>and may you strike gold</h3>
    <pre>
    {
        name: "Gary J. Murakami, Ph.D.",
        title: "Ruby Evangelist / Engineer",
        phone: "1-866-237-8815 x8015",
        mobile: "1-908-787-6621",
        email: "gary.murakami@10gen.com",
        im: "gjmurakami (AIM)",
        twitter: "@GaryMurakami",
        blog: "grayghostwriter.blogspot.com",
        website: "www.nobell.org",
        linkedin: "www.linkedin.com/pub/gary-murakami/1/36a/327",
        facebook: "facebook.com/gary.j.murakami"
    }
    </pre>
    <ul>
        <li><a href="https://github.com/gjmurakami-10gen/talk-mother-load">https://github.com/gjmurakami-10gen/talk-mother-load</a></li>
        <li>git://github.com/gjmurakami-10gen/talk-mother-load.git</li>
        <br/>
        <li><a href="http://www.mongodb.org/display/DOCS/Home">MongoDB</a></li>
        <li><a href="http://www.mongodb.org/display/DOCS/Ruby+Language+Center">Ruby Language Center</a></li>
        <li><a href="https://github.com/mongodb/mongo-ruby-driver">Github mongodb/mongo-ruby-driver</a></li>
    </ul>
</section>
</div>

<!-- The navigational controls UI -->
<aside class="controls">
    <a class="left" href="#">&#x25C4;</a>
    <a class="right" href="#">&#x25BA;</a>
    <a class="up" href="#">&#x25B2;</a>
    <a class="down" href="#">&#x25BC;</a>
</aside>

<!-- Presentation progress bar -->
<div class="progress"><span></span></div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,

        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/linear(2d)

        // Optional libraries used to extend on reveal.js
        dependencies: [
            { src: 'lib/js/highlight.js', async: true, callback: function() { window.hljs.initHighlightingOnLoad(); } },
            { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
            { src: 'lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'socket.io/socket.io.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
            { src: 'plugin/speakernotes/client.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
        ]
    });

</script>

</body>
</html>
